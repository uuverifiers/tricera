#!/bin/sh

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

if [ "$1" = "-native" ]; then
    shift
    export TRI_CMD="$ROOT_DIR/tri-native"
else
    export TRI_CMD="$ROOT_DIR/tri"
fi

echo "Using TRI_CMD=$TRI_CMD"

ERRORS=0

run_test() {
    "$@"
    if [ $? -ne 0 ]; then
        ERRORS=1
    fi
}

run_test ./rundir horn-hcc-heap "" -assertNoVerify -dev -t:60
run_test ./rundir horn-hcc-array "" -assertNoVerify -dev -t:60
run_test ./rundir horn-bv "" -assert -dev -t:60
run_test ./rundir horn-hcc "" -assert -dev -t:60
run_test ./rundir horn-hcc-2 "" -assert -dev -t:60
run_test ./rundir horn-hcc-pointer "" -assert -dev -t:60
run_test ./rundir horn-hcc-struct "" -assert -dev -t:60
run_test ./rundir horn-hcc-enum "" -assert -dev -t:60
run_test ./rundir horn-contracts "" -assert -dev -t:60
run_test ./rundir acsl-contracts "" -assertNoVerify -t:60
run_test ./rundir acsl-standalone "" -m:foo -assertNoVerify -cex -t:60
run_test ./rundir uninterpreted-predicates "" -assert -dev -t:60
run_test ./rundir math-arrays  "" -assert -dev -t:60
run_test ./rundir quantifiers "" -assert -dev -t:60
run_test ./rundir interpreted-predicates "" -assert -dev -t:60
run_test ./rundir properties "" -assert -dev -t:60
run_test ./rundir toh-contract-translation "" -dev -t:60
run_test ./rundir loop-invariants "" -m:foo -inv -acsl -cex -dev -t:60
run_test ./rundir at-expressions "" -assert -dev -t:60
#run_test ./rundir ParametricEncoder ""

if [ $ERRORS -ne 0 ]; then
    exit 1
fi

exit 0
